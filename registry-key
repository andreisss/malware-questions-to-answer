Run keys
Entering a file path in the registry data under these registry keys will trigger execution
when Windows starts, as can be seen in the following registry path for the Windows 64-bit
versions
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnceEx
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\N\RunServicesOnce
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Windows\CurrentVersion\Run

Programs that are listed under these registry keys will trigger execution when the current
user logs in, as can be seen in the following registry path:
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnceEx
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce
HKEY_CURRENT_USER\Software\Microsoft\WindowsNT\CurrentVersion\Windows\Run

The keys names containing Once will have the listed programs that run only once. The
malware may still persist if it keeps on placing its own file path under the RunOnce,
RunOnceEx or RunServicesOnce keys.


The following registry values, under their respective registry key, will trigger execution when any user logs in:
HKEY_CURRENT_USER\Software\Microsoft\WindowsNT\CurrentVersion\Windows
Load = <file path>
Run = <file path>
BootExecute value
HKEY_LOCAL_MACHINE\SYSTEM\ControlSetXXX\Control\Session Manager
XXX in ControlSetXXX is a three digit number usually ControlSet001, ControlSet002, or ControlSet003.

BootExecute = <file path>
The default value of BootExecute is autocheck
autochk *
Winlogon key
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WindowsNT\CurrentVersion\Winlogon
Activities under this registry key are executed during Windows logon

UserInit = <file path>
The default value of Userinit
is C:\Windows\system32\userinit.exe
Notify = <dll file path>
Notify is not set by default. It is expected to be a dynamic link library file
Shell = <exe file path>
The default value of Shell is explorer.exe
HKEY_CURRENT_USER\SOFTWARE\Microsoft\WindowsNT\CurrentVersion\Winlogon
Shell = <exe file path>

The default value of Shell is explorer.exe
Identification and Extraction of Hidden Components

Policy scripts keys
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\N
where N is a number starting from 0. Multiple scripts orexecutables can be run during the shutdown sequence
Script = [file path of executable file or script]
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup\0\N

This is where N is a number starting from 0. Multiple scripts or executables can be run during the startup sequence.
Script = [file path of executable file or script]
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Logon\0\N
This is where N is a number starting from 0. Multiple scripts or executables can be run when a user logs off.
Script = [file path of executable file or script]
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Logoff\0\N  where N is a number starting from 0. Multiple scripts or
executables can be run when a user logs off
Script = [file path of executable file or script]
AppInit_DLLs values
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WindowsNT\CurrentVersion\Windows
AppInit_DLLs = [a list of DLLs]
The list of DLLs are delimited by a comma or space
LoadAppInit_DLLs = [1 or 0]
Here, 1 means enabled, and 0 means disabled
Identification and Extraction of Hidden Components Chapter 2

Services keys
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\[ServiceName]
This is where ServiceName is the name of the service ImagePath = [sys/dll file path]
Loads a system file (.sys) or a library file (.dll), which is the driver executable
The service triggers depending on the value of the start:
0 (SERVICE_BOOT_START triggers when OS is being
loaded)
1 (SERVICE_SYSTEM_START triggers when OS is
being initialized)
2 (SERVICE_AUTO_START triggers when service
manager starts.)
3 (SERVICE_DEMAND_START triggers when it is
manually started)
4 (SERVICE_DISABLED. The service is disabled fromtriggering)

File associations
HKEY_CLASSES_ROOT or in HKEY_LOCAL_MACHINE\SOFTWARE\Classes\[File type or extension name]\shell\open\command
The entry in the (Default) registry value executes files that are described by [File type or extension name].
The following code shows the associated entry for executable files or .EXE files:
HKEY_LOCAL_MACHINE\SOFTWARE\Classes\exefile\shell\open\command>

Startup values
The startup registry value contains the path to a folder which contains files that are executed after the user has logged in. The default folder location is
at %APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup.
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Exp lorer\Shell Folders
Startup = [startup folder path]
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Exp lorer\User Shell Folders
Startup = [startup folder path]
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Ex plorer\User Shell Folders
Common Startup = [startup folder path]
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
Common Startup = [startup folder path]

The Image File Execution Options key
File paths set in the debugger of the Image File Execution Options key is run when 
the process is to be debugged or is run with the CreateProcess API: HKEY_LOCAL_MACHINE\Software\Microsoft\WindowsNT\CurrentVersion\Image File Execution Options\[Process Name]
Debugger = [executable file]
[Process Name] pertains to the filename of the running executable
This persistence only triggers when there is a need for [Process Name] to invoke a debugger Browser Helper Objects key
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Ex plorer\Browser Helper Objects\[CLSID]
Having the CLSID as a subkey simply means that it is installed and enabled as an Internet Explorer BHO
The CLSID is registered under the HKEY_CLASSES_ROOT\CLSID\[CLSID]\InprocServer32 key
The (Default) value points to the DLL file associated with the BHO
The DLL file is loaded every time Internet Explorer is opened
